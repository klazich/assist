const AQL_LEVEL = [.010, .015, .025, .040, .065, .10, .15, .25, .40, .65, 1.0, 1.5, 2.5, 4.0, 6.5, 10.0];
const LOT_SIZE = [2, 8, 15, 25, 50, 90, 150, 280, 500, 1200, 3200, 10000, 35000, 150000, 500000];
const AQL_TABLE = [
  // -> .010, .015, .025, .040, .065, .10, .15, .25, .40, .65, 1.0, 1.5, 2.5, 4.0, 6.5, 10.0
  ['ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 5, 3, 2, 2],
  ['ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 13, 8, 5, 3, 2, 2],
  ['ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 20, 13, 8, 5, 3, 3, 2],
  ['ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 32, 20, 13, 8, 5, 5, 5, 3],
  ['ALL', 'ALL', 'ALL', 'ALL', 'ALL', 'ALL', 80, 50, 32, 20, 13, 8, 7, 6, 5, 4],
  ['ALL', 'ALL', 'ALL', 'ALL', 'ALL', 125, 80, 50, 32, 20, 13, 12, 11, 7, 6, 5],
  ['ALL', 'ALL', 'ALL', 'ALL', 200, 125, 80, 50, 32, 20, 20, 19, 13, 10, 7, 6],
  ['ALL', 'ALL', 'ALL', 315, 200, 125, 80, 50, 48, 47, 29, 21, 16, 11, 9, 7],
  ['ALL', 800, 500, 315, 200, 125, 80, 75, 73, 47, 34, 27, 19, 15, 11, 8],
  [1250, 800, 500, 315, 200, 125, 120, 116, 73, 53, 42, 35, 23, 18, 13, 9],
  [1250, 800, 500, 315, 200, 192, 189, 116, 86, 68, 50, 38, 29, 22, 15, 9],
  [1250, 800, 500, 315, 300, 294, 189, 135, 108, 77, 60, 46, 35, 29, 15, 9],
  [1250, 800, 500, 490, 476, 294, 218, 170, 123, 96, 74, 56, 40, 29, 15, 9],
  [1250, 800, 750, 715, 476, 345, 270, 200, 156, 119, 90, 64, 40, 29, 15, 9],
  [1250, 1200, 1112, 715, 556, 435, 303, 244, 189, 143, 102, 64, 40, 29, 15, 9]
];

const getSampleSize = (aql, lotSize, cb) => {
  let aqlIndex = AQL_LEVEL.findIndex(v => v === aql);
  let lotIndex = LOT_SIZE.findIndex(v => lotSize < v) - 1;
  let result = AQL_TABLE[lotIndex][aqlIndex];
  let sampleSize = result === 'ALL'
    ? lotSize
    : result
  cb(undefined, sampleSize);
}

module.exports = { getSampleSize } 